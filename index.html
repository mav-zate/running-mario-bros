<!DOCTYPE html>

<!--
SOURCES:

Mario sprite
https://www.spriters-resource.com/nes/supermariobros/sheet/50365/
transparency tool
http://www198.lunapic.com/editor/
Goomba sprite
http://www.superluigibros.com/super-mario-bros-sprites
explosion sprite
http://www.luxinia.de/index.php/Tutorials/Tutorial19
explosion sound
http://soundbible.com/538-Blast.html
super mario theme song
https://www.youtube.com/watch?v=iy3qq7zc4EY
mario jump sound
http://themushroomkingdom.net/media/smb/wav
donkey kong arcade theme
https://www.youtube.com/watch?v=Pp2aMs38ERY
 -->

<html>
  <head>
    <link rel="stylesheet" type="text/css" href="./lib/styles/style.css"/>
    <script type="text/javascript" src="./lib/scripts/instructions.js"></script>
    <script type="text/javascript" src="./lib/scripts/bundle.js"></script>
    <title>Running Mario Bros</title>
    <link rel="icon" type="image/png" href="./images/mav_logo.png">
  </head>
  <body>
    <header>
      <a href="http://www.maverickalzate.com">
      <span
      id="header-left">
        <img
        src="https://s3.amazonaws.com/running-mario-bros-dev/header/mav_logo_nintendo.png"
        width="50px" height="50px"/>
        MAVERICK ALZATE
      </span>
      </a>
      <span id="header-right">
        <a href="http://www.linkedin.com/in/maverick-alzate" target="_blank">
          <img src="https://s3.amazonaws.com/running-mario-bros-dev/header/LinkedIn-Logo-500x500.png" width="50px" height="50px"/>
        </a>
        <a href="http://www.github.com/mav-zate" target="_blank">
          <img src="https://s3.amazonaws.com/running-mario-bros-dev/header/githubLogo_500500.png"/width="50px" height="50px"/>
        </a>
        <a href="mailto:maverick.alzate@gmail.com" target="_blank">
          <img src="https://s3.amazonaws.com/running-mario-bros-dev/header/gmail.png"
          width="50px" height="50px"/>
        </a>
      </span>
    </header>

    <div id="game-space">
      <canvas id="end-screen" width=800 height=500 style="z-index: 1;"></canvas>
      <canvas id="game-screen" width=800 height=500 style="z-index: 3;"></canvas>
      <canvas id="mario" width=800 height=500 style="z-index: 4;"></canvas>
    </div>

    <div id="start-screen">
      <h1>RUNNING MARIO BROS.</h1>
      <section class="button-section">
        <button id="play-button">PLAY</button>
        <button id="instructions-button">INSTRUCTIONS</BUTTON>
        <button id="music-button">MUSIC</button>
      <section>
    </div>


    <script src="https://www.gstatic.com/firebasejs/4.3.1/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAlcgIhzR1whJNrO1HzCxom3mwZ6y3oSi8",
        authDomain: "running-mario-bros.firebaseapp.com",
        databaseURL: "https://running-mario-bros.firebaseio.com",
        projectId: "running-mario-bros",
        storageBucket: "running-mario-bros.appspot.com",
        messagingSenderId: "752893416417"
      };
      firebase.initializeApp(config);
      var database = firebase.database();

      // render highscores
      let highscoreMenu = document.createElement('div');
      highscoreMenu.setAttribute('id', 'high-score-menu');
      let highscoreTitleDiv = document.createElement('div');
      let highscoreTitle = document.createElement('p');
      let highscoresDiv = document.createElement('div');
      highscoresDiv.setAttribute('id', 'high-scores');
      highscoreTitle.textContent = 'HIGH SCORES:';
      highscoreTitleDiv.appendChild(highscoreTitle);
      highscoreMenu.appendChild(highscoreTitleDiv);
      highscoreMenu.appendChild(highscoresDiv);
      let gameSpace = document.getElementById('game-space');
      gameSpace.appendChild(highscoreMenu);



      database.ref('scores/').limitToLast(5)
        .orderByValue().once('value').then(function(snapshot) {
        snapshot.forEach((snap) => console.log(snap.val()));

        snapshot.forEach(function(snap) {
          let name = snap.key;
          let score = snap.val();
          let highscoreEntry = document.createElement('div');
          highscoresDiv.insertBefore(highscoreEntry, highscoresDiv.firstChild);
          let username = document.createElement('p');
          username.textContent = name;
          highscoreEntry.appendChild(username);
          let highscore = document.createElement('p');
          highscore.textContent = score;
          highscoreEntry.appendChild(highscore);
        });
      });

      // write score to database
      let writeInt = window.setInterval(() => {
        let playerNameTag = document.getElementById('player-name');
        let playerScoreTag = document.getElementById('player-score');
        if (playerNameTag && playerScoreTag) {
          let username = playerNameTag.textContent;
          let updateKey = 'scores/' + username;

          let score = parseInt(playerScoreTag.textContent);
          database.ref().update({
            [updateKey]: score,
          });
          console.log('Score written to database');
          window.clearInterval(writeInt);
        }
      }, 100);
    </script>
  </body>
</html>
